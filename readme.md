# 一，引言

### 1.1　研究背景与意义

随着人类在科技上的不断进步，信息的交流变得更加方便快捷，同时也呈现着多元化的趋势。网络，计算机逐渐改变着人们的生活方式，互联网逐渐成为人们生活中必不可少的一项，并且逐步渗透到各个传统行业中。在这种背景大环境下，信息管理显得越来越重要，当然，发展也是越来越快，随着这种信息化的趋势，也给酒店，学校，政府等一系列部分带来了很大的便利。互联网方向的管理系统逐渐在各个领域发光发热。

随着国民生活水平的提高，对于酒店来说，每天成百上千的人入住酒店，如何做好用户查询酒店、预订房间、退订房间等工作是传统酒店的一大问题。如果能实现酒店管理的自动化，无疑对企业来说会带来很大的便利。在互联网大规模应用于各行各业之前，酒店信息管理需要投入人力物力。伴随着社会的进步，人们生活水平的提高，越来越多的人们成为了酒店常客，这就导致酒店不断扩张，酒店信息管理需要投入大量的人力物力，慢慢的导致效率变低，酒店服务度变低，成为了一定恶性循环。这时互联网的引入无疑是酒店的一剂强心针，帮助酒店解决了大量问题，酒店各个板块通过互联网信息管理系统变得越来越快捷与方便，提高酒店效率与顾客满意度。

开放性的酒店信息管理服务性系统，不断满足酒店业务升级以及行业发展的变化。系统开发具有一定的超前意识，强调系统的开放性、模块化、标准化等设计，有明确的组织架构以及需要实现的功能模块，换不同规格、不同模式的酒店，利用系统的功能模块分配可以灵活组织，适用于各类大中小型酒店。

### 1.2 项目研究现状

在当今这个信息化的时代，信息传递变得迅猛及时，掌握不了最新的信息，就有可能在人类的发展之路上掉队。现在酒店的人流量也是很大的，必须做到安全有效的管理，这样才能用最好的环境去服务旅客。

酒店每天在为客人的提供结算账单、提供查询、登记信息的记录、订房的信息、对客房状况的统计等方面具有很大的工作量。在进行上述各项业务时运用一些传统的手工方式可能具有一些不方便的地方，比如不仅需要大量的人手，而且速度比较慢，同时错误出现的可能性也会比较大。而在进行酒店的管理时，对管理信息的系统科学合理的运用可以把业务运作的准确性和速度大大的提高。

可以推动酒店的信息管理规范化进程，从而将服务的质量提高，算机在进行信息的处理时具有相当快的速度，所以在很大的程度上可以将客人在结账、购物、娱乐、用餐和住宿登记时等候的时间节省下来。同时，管理信息系统可以为住店客人提供的所有信息和服务具有规范、准确、及时的特点，从而将错误可能性大大降低了，还可以随时的查询有关信息，可以给客人提供留言以及叫早等服务，因此，酒店管理信息系统的运用可以帮助酒店去进行市场的开拓，同时树立自己的特色形象。

当然，也可以推动酒店经济效益的提高，运用管理信息系统可以节省酒店自身的人力物力，从而实现节流的目的。同时，酒店可以通过对管理信息系统的合理利用，不断的去增加自身的服务项目，可以提升酒店的服务档次，从而实现开源。因此，管理信息系统在酒店管理中的运用能有效地提高酒店的经济效益。

酒店在面对激烈的市场竞争时，必须能科学合理的预测分析各种业务和酒店的经营状况。在这个过程当中，酒店管理信息系统能把当前的数据以及历史的资料及时的提供出来，同时还可以进行同期的对比分析，并且提供其他的分析模式。在这样方便的条件下，管理人员能很快的将复杂的分析工作完成。

### 1.3 项目研究目标内容及要求

* 设计概要

系统采用 HTML, css, JavaScript 只是进行前端展示，后台使用 php 开发，采用 mysql 数据库，开发工具使用 phpstorm, web 容器是 apache，系统框架采用 Symfony 开发。通过数据库和开发工具的结合进行设计开发，通过不断修改和不断的测试，进一步升级系统，全面的实现系统功能。

* 设计内容

本系统是一个酒店信息管理系统，同时具备用户模块功能，开发前台查询服务。系统拥有简单使用的操作界面，显示酒店的所有信息，并且能够进行查询流水信息，通过房间类型，房间号，时间维度查询。还可以管理酒店房间，房间分类，以及对人员的管理。

* 设计目标

完成这个复杂的系统，加强自身的代码能力，以及数据库设计的能力，更重要的是处理数据，管理数据的能力，在整个系统的完成中，可以学到各类的知识，百利而无一害。

* 设计要求

通过收集国内外的参考文献，制定工作计划，运用各种研究方法，独立的完成毕设工作，按任务书的要求，在期限内完成开题报告，中期的检查工作，系统的演示，论文的撰写和答辩的工作，论文要求概念清楚，内容正确，条理分明，语言流畅，结构清晰。

### 1.4 本文结构

本文从酒店信息管理系统的研究现状出发，分析了该系统设计与实现的背景与意义，并对该项目的研究现=现状进行了介绍。然后对系统实现时所采用的关键技术进行了阐述。最后结合系统的需求，对系统的设计和实现进行详细的说明。其中有这些：

第一章是引言。主要介绍系统的研究背景与意义，以及研究的现状。

第二章对系统采用的关键技术进行介绍，包括 php, Symfony, 以及数据库采用的 Mysql。

第三章是系统分析和设计部分。主要包括这两个内容：数据库设计和需求分析。数据库设计部分通过数据流图、数据字典，以及系统的数据库设计进行具体介绍。需求分析部分对系统设计的总体目标和具体目标进行了阐述，明确了设计的方向。

第四章是系统详细设计和实现部分。是论文的核心部分，对系统的输入/输出设计进行了一些介绍，并且对系统的功能模块，体系结构以及处理过程进行了详细的介绍。

第五章是系统测试部分。从本系统测试目标和任务出发，采用最适当的测试方案，实现了对系统的测试。

第六章十总结和展望部分。通过总结出系统的一些问题，提出对未来的研究方向。

# 二 关键技术分析

### 2.1 web 发展概述

互联网 web　技术发展 30　余年，从 web1.0 时代到 web2.0 时代，接着是现在的 web3.0　时代，从上网的习惯到工具，从主机（服务器端）到桌面（客户端），再到Web（服务器端），现在又发展到了现代化的Web——客户端功能越来越强，越来越多的工作又回到了客户端。Web1.0是一家实体商店，房子就在那里，你随时都可以来：台式电脑使得人们只能在固定的地点连入网络。

Web2.0是一家移动商店，随时随地跟着你等待你的即时召唤；移动设备使得人们随时随地可以连入网络。

Web3.0则是商店和你是一体的，你自己就可以娱乐自己。人机交互意味着“人”和“科技”的距离进一步缩短，甚至可以说“科技”逐渐演变成为“人”的组成部分之一。

Web1.0是过去时，2.0是现在时，3.0是将来时。从现下正值壮年的Web2.0的特点中，也许可以看出过去和未来的变化。

web 语言的发展如今也是百花齐放，Ruby on Rails, Python, PHP, JSP, .NET ASP, NodeJs 等等，虽然语言只是工具，但是选择工具的任然是人类，所以我选择 php，不要问我为什么，因为 php 是世界上最好的语言。

### 2.2 php 的介绍

这里我不是针对谁，很多人对 php 的认识仍然停留在 php 5.0 之前，不得不承认，那时的 php 真的有很多诟病，没有面向对象，没有命名空间，基本上就是一个 c 语言用来做 web 开发的拓展。不过，从 php5.4 之后开始，性能以及语言本身都有了不知道多少倍的提升，如果你现在让一个 c++ 程序员来看 php 代码，他第一反应会是，怎么这么像，不要问我为什么。php 在 OOP 这块大费苦心，语言目前以前很 OOP 了。那么还是来介绍下吧，有些东西不说清楚，很多人不懂。

PHP 是英文 Hypertext Preprocessor ( 超文本预处理器 ) 的缩写，它是一种服务器端的脚本 编程 语言，其特点是简单、面向对象、解释执行、健壮安全、独立于架构、可移植、动态。

### 2.3 php的特点

系统使用 php 开发，也是由于 php 具备以下这些特点：

* 开源性

首先，他开源，这样就不存在什么病毒植入危言论，其实，源代码就是最好的学习资料，通过对源代码的研究，你可以获得很强的查克拉。然后你就可以很牛。在其次，如果有些问题你不能很好的解决，你可以通过修改源代码或是添加拓展的方式去解决你的问题。

* 强大的函数库

php 的 build_in 函数是我目前见过语言中最多的，你不要想其他语言一样 import 或是 require，你可以直接使用它。

* 最好的文档

php 的文档是开源的，开发者可以去贡献自己对 php 的理解，去添加例子，在 php 官网随便找个函数，你甚至可以看到 2000 年之前的评论贡献。所以，你不用担心你会看不懂，不会用。

* 最好的包管理

或许你会说 java 有 maven，python 有 pip，nodejs 有 npm，ruby 有 gem，那么 php 的 composer 为什么是最好的，这个问题也没有为什么，信仰而已。

* 最多的开发者

如果你有任何开发中遇到问题，只要你有科学上网和英文阅读的能力，你就可以找到答案，你的问题真的在 10 年前就有人遇到并且解决了，还留下了完整的解决方案。毕竟，会 php 的开发者是很多的，有人说，phper 因为语言本身没有优势，所以人比较热情，我不知道是不是真的。

* 跨平台

由于跨平台性，你可以在你熟悉的微软 windows 上开发，然后发布到一台 linux 服务器上面运行，这是完全没有问题的。

* 简易性

这是最重要的一条，由于太简单，所以基本在使用上，是没有门槛的，想用就用吧。

### 2.4 Symfony 的介绍

Symfony 提高了代码的抽象级别。相对于简单的，直接暴露底层概念的 PHP 语言，Symfony 提供了一套解决特定工程问题的概念和工具，帮助广大的 Coder 的减少重复性工作。抽象化意味着能用更简洁的东西表达复杂的概念，流程等。Symfony 一些介绍：

* 路由：能限制 hostname，这就让有大量公共功能的网站可以共用一套代码；URI 识别支持 Reg 检测，让 url 能定义的随心所欲；支持前缀，import，便于模块化。

* wig模板：这是我最喜欢的一个组件。它提供了一套不同于 php，但非常适合处理复杂网站结构，页面结构的语法。extension 很方便也很强大，通用的操作通过 extension 能很好的表达，比如需要缓存页面的某个模块到 redis ，写一个 ViewExtension，就能在模板里面用一个方法来缓存特定模块了，非常方便，代码也很容易管理。

* composer包管理：让代码的依赖关系变得很清晰。而且现在第三方有很多不错的 bundle，比如抽象 redis 的 snc/redis-bundle，处理图片的 liip/imagine-bundle，第三方登录的 hwi/oauth-bundle 等等等等。随着自己项目的逐渐成熟，也可以把项目对 Symfony 的定制独立出来用 composer 来管理，感觉挺不错的。

* Event，Listener 和 Services：非常方便的全局功能处理。惹人讨厌的是配置起来很麻烦，我用的是 yml 配置文件，为了找对路的语法真是掉了一层皮。

### 2.5 Mysql 介绍

MySQL基本是生于互联网，长于互联网。其应用实例也大都集中于互联网方向，MySQL的高并发存取能力并不比大型数据库差，同时价格便宜，安装使用简便快捷，深受广大互联网公司的喜爱。并且由于MySQL的开源特性，针对一些对数据库有特别要求的应用，可以通过修改代码来实现定向优化，例如SNS、LBS等互联网业务。

最大的一个特色，就是自由选择存储引擎。每个表都是一个文件，都可以选择合适的存储引擎。常见的引擎有 InnoDB、 MyISAM、 NDBCluster等。但由于这种开放插件式的存储引擎，比如要求数据库与引擎之间的松耦合关系。从而导致文件的一致性大大降低。在SQL执行优化方面，也就有着一些不可避免的瓶颈。在多表关联、子查询优化、统计函数等方面是软肋，而且只支持极简单的HINT。

Mysql 同时也是开源并且免费的，轻松的获取，廉价的学习成本，大学生的最好选择了。

php 和 mysql 自古以来就是一对好基友，php 对 mysql 的支持不输于任何一门后台语言，所以选择 php 之后，基本数据库也就确定了。

Mysql支持所有标准SQL中的数值类型，其中包括严格数据类型(INTEGER,SMALLINT,DECIMAL,NUMBERIC)，以及近似数值数据类型(FLOAT,REAL,DOUBLE PRESISION),并在此基础上进行扩展。
扩展后增加了TINYINT,MEDIUMINT,BIGINT这3种长度不同的整形，并增加了BIT类型，用来存放位数据。

|整数类型|字节|范围（有符号）|范围（无符号）|用途|
|-----|-----|-----|-----|-----|
|TINYINT|1字节|(-128，127)|(0，255)|小整数值|
|SMALLINT|2字节|(-32 768，32 767)|(0，65 535)|大整数值|
|MEDIUMINT|3字节|(-8 388 608，8 388 607) (0，16 777 215)|大整数值|
|INT或INTEGER|4字节|(-2 147 483 648，2 147 483 647)|(0，4 294 967 295)|大整数值|
|BIGINT|8字节|(-9 233 372 036 854 775 808，9 223 372 036 854 775 807)| (0，18 446 744 073 709 551 615)|极大整数值|
|FLOAT|4字节|(-3.402 823 466 E+38，1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)|0，(1.175 494 351 E-38，3.402 823 466 E+38)|单精度浮点数值|
|DOUBLE|8字节|(1.797 693 134 862 315 7 E+308，2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)|0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)|双精度浮点数值|

Mysql 有多语言接口， 支持很多编程语言接口，比如C/C++、Java等，得到很多开发者的喜爱。安全性也是很好的，SQLite数据库通过数据库级上的独占性和共享锁实现独立事务处理。这就意味着多个进程可以在同一时间从同一数据库读取数据，但只有一个可以写入数据[28]。在某个进程或线程向数据库执行写入操作之前，必须取得独占锁。在发出独占锁后，其他的读或写操作将不会在发生。

# 三，系统分析与设计

### 3.1 系统的可行性分析

### 3.1.1 技术可行性

该系统基于 php 开发语言和 symfony 框架开发，首先，php是开源的，然后 symfony 也是开源的，而且社区文档都维护的很好，对中文的支持也很好。再加上如今的网络化时代，学习资源的随意获取，所以基本不用担心会遇到技术上的难题，因此，技术上可行，调试相对野比较简单，同时数据库采用的是 Mysql 数据库。所有的技术都是非常成熟并且开源的，而且目前武术的中小型也是使用的该组合。综上所述，本系统的开发在技术上完全可行，没有问题。

### 3.1.2 经济可行性

由于互联网的飞快大战，各种资源的共享和交流也是很容易的，本软件的所有资源都开元与互联网，并且十合法获取的。开发软件也是免费的，php环境的部署也是非常简单，基本上只有有一台笔记本就可以解决了。综上所述，经济上可行。

### 3.1.3 操作可行性

该酒店信息管理系统的开发目标就是：能够操作方便的，性能良好，安全油耗的去管理酒店的业务。更具系统的设计需求，系统开发完成之后，会有简单操作，方便灵活的优点。加上本系统一键部署的特性，就算是部署在真实的服务器上也是非常简单的。而且整个系统非常灵活，拓展新很强，有其他的功能也很容易的添加，所以在操作上，是可行的。

### 3.2 需求分析

### 3.2.1 功能需求分析

根据目前对现有酒店网站的研究，以及对现有各个管理系统的分析，然后结合本系统的任务书，及其基本的结构进行分析，对流程进行处理，确定初了基本的处理要求，我们可以知道为了让用户使用起来更加便捷，界面要简洁直观，功能不能太过复杂和累赘。综上所述，本系统会实现以下的功能：

用户的行为:

* 注册：酒店服务员注册
* 登录：酒店服务员登录
* 密码找回：服务员，管理员找回密码
* 修改密码：登录用户修改密码
* 修改资料：登录用户修改资料

用户模块:

* 增：管理员增加用户
* 删：管理员删除用户
* 改：管理员修改用户信息
* 查：管理员查看用户信息

酒店房间分类模块:

* 增：管理员增加房间分类
* 删：管理员删除房间分类
* 改：管理员修改房间分类信息
* 查：管理员查看房间分类信息

酒店房间模块:

* 增：管理员增加房间
* 删：管理员删除房间
* 改：管理员修改房间信息
* 查：管理员查看房间信息

订房模块：

* 增：管理员增加订单
* 删：管理员删除订单
* 改：管理员修改订单信息
* 查：管理员查看订单信息

前台模块：

* 查看所有房间房间
* 按价格搜索房间
* 按打折区间搜索房间
* 显示当前房间预约情况

控制台模块：

* 查看酒店历史收入
* 按房间类型查询流水
* 按房间号查询流水
* 按时间查询流水
* 按时间范围查询流水

系统设置模块：

*　设置系统信息

### 3.2.2 非功能需求分析

* 可维护性

程序代码完全模块化，代码风格一致，命名规范，完全面向对象，并且文档完整。系统长时间的运行是稳定的，用户可以安全退出。就算过再久，代码也能狗很快读懂并且维护。

* 可拓展性

系统使用 mysql,数据结构编程方法基本保持一致，使用目前主流的开发模式。编码都遵循了一定的标准，有一定的根据。系统在升级时可以保留原有的数据，是系统易于升级拓展，技能满足当前的需求，有为拓展功能提供了一定的空间。

* 操作性

系统界面非常简介，只保留对系统有用的部分，其他的都舍去，用心专注最有用的功能，使用户能在最短的时间内上手该系统，并且能做出最有效的操作。这样，系统的操作性久非常的强。

* 人性化

对于系统中比较重要的操作，比如记录的删除，当用户点击删除时，都会弹出相应的提示框，防止由于用户的疏忽或是不小心，造成不必要的损失。这样如果用户没有正确的点击就不会执行操作，防止失误。

* 帮助提醒

从各个角度设置了一些提醒功能，对于那些比较复杂的操作，都会有相应的提醒，告诉用户怎么去操作，给系统最大的可用性。

### 3.3 总体设计

本酒店管理系统基于 php 语言设计的主要功能模块包括：用户模块，用户注册，用户登录，使用邮箱和密码登陆。密码找回，发送修改密码的链接到用户邮箱，修改密码。用户修改自身信息。管理员登陆到后台，有以下模块：控制台模块，查看酒店当前的所有信息。系统设置模块，修改系统的设置以便在各个页面显示。用户模块：对所有用户进行增删改查。房间分类模块，房间初始化有几下分类，单间，标间，双人间，豪华单人间，以及总统套房，当然可以对这些进行增删改查。房间模块，显示房间的所有信息，包括他属于的房间分类名称，而且也具有增删改查的功能。订单模块，获取订单的所有信息，包括日期，以及该订单所需要的所有经费，在查询订单部分，可以根据房间的分类查询，房间号查询，以及时间查询。在右上角，登陆之后会出现用户图标，当然，点击用户图标，弹出的退出按钮，可以删除用户所有的隐私信息，安全耳朵退出该系统，如下图所示：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f34ez5ym38j20by0fujsj.jpg)

# 3.4 数据流图

根据“功能分解，逐步求精”的原则，此次需求分析数据流图主要分为三层：顶层数据流图：确定出系统的输入与输出，第一层数据流图：对系统进行第一层的功能分解，分析每一个模块的数据流。最后，总体上自顶而下，逐层细化的方法，没一部分的数据流图如下：

顶层数据流图：主要包括管理员，系统，数据库

![](http://ww3.sinaimg.cn/mw690/baa3278fgw1f34fnqnvq0j20cv078jrl.jpg)

第一层数据流图：主要包括用户以及其各项交互操作

授权模块：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f34fxmx1f4j20g70d70tb.jpg)

订单查询模块：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f34g2gf0eqj208z09xgly.jpg)

其他模块:

![](http://ww3.sinaimg.cn/mw690/baa3278fgw1f34g5y99vsj20cg09zdga.jpg)

### 3.5 数据库设计

### 3.5.1 数据库设计的原则

一个确保数据库事务正确执行的四个基本要素是：

* 原子性：基本表中的字段是不可再分解的。
* 原始性：基本表中的记录是原始数据（基础数据）的记录。
* 演绎性：由基本表与代码表中的数据，可以派生出所有的输出数据。
* 稳定性：基本表的结构是相对稳定的，表中的记录是要长期保存的。

为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种规则就称为范式。范式是符合某一种设计要求的总结。要想设计一个结构合理的关系型数据库，必须满足一定的范式。在实际开发中最为常见的设计范式有三个：

* 第一范式(确保每列保持原子性)
* 第二范式(确保表中的每列都和主键相关)
* 第三范式(确保每列都和主键列直接相关,而不是间接相关)

我们还需要关联数据库，不然就去使用 no-sql 数据库了，关联的好处：

* 整洁、简单，独立性强。从整个系统来看，虽然关联多出了不少表格，但是每张表都是独立的，很好的维护了整个系统的简洁性。
* 将部分逻辑业务交给了DBA，在数据库接口层注重的是sql查询语句的编写，上层业务开发人员可以省下不少力气。
* 由于关联的字段都是用主键进行查询的，减少了出错的可能性。再者，不关联的表的记录的更改可能会涉及到多张表格的同步问题，处理不好也容易出错。
* 关联的表多用到sql语句来完成业务与逻辑，而不关联的表可能要上层程序本身负担一部分逻辑判断的任务，这样子混乱的逻辑与烦杂的判断，则需要多次封装继承。因此关联还是降低了程序员出错的可能性。

### 3.5.2 数据字典

根据需求分析中功能的需求以及对总体的设计，同时对酒店信息管理系统处理过程的分析，另外包括对数据流图参考，本设计的数据字典有以下一些：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f34gg7r0uqj20dj080glq.jpg)

### 3.5.3 系统 E-R 图

![](http://ww1.sinaimg.cn/mw690/baa3278fgw1f34h1p0uh8j20ih0k2q4x.jpg)

### 3.5.4 数据表设计

根据上面的 e-r 图，设计如下一些数据库：

用户表(users)的设计:

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| id             | int(10) unsigned      | NO   | PRI | NULL    | auto_increment | 主键 |
| name           | varchar(255)     | NO   |     | NULL    |                | 用户名 |
| email          | varchar(255)     | NO   | UNI | NULL    |                | 邮箱 |
| password       | varchar(60)      | NO   |     | NULL    |                | 密码 |
| is_admin       | tinyint(1)       | NO   |     | 0       |                | 是否为管理员 |
| remember_token | varchar(100)     | YES  |     | NULL    |                | 记住密码令牌 |
| created_at     | timestamp             | YES  |     | NULL    |                | 创建时间 |
| updated_at     | timestamp             | YES  |     | NULL    |                | 修改时间 |

修改密码表(password_resets)设计：

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| email      | varchar(255) | NO   | MUL | NULL              |   | 邮箱 |
| token      | varchar(255) | NO   | MUL | NULL              |   | 令牌 |
| created_at     | timestamp             | YES  |     | NULL    | on update CURRENT_TIMESTAMP        | 创建时间 |

房间表(rooms)的设计：

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| id             | int(10) unsigned      | NO   | PRI | NULL    | auto_increment | 主键 |
| no           | varchar(255)     | NO   | MUL | NULL                  |                |
| room_type_id | int(10) unsigned | NO   | MUL | NULL                  |                |
| price        | int(11)          | NO   |     | NULL                  |                |
| discount     | double(8,2)      | NO   |     | 10.00                 |                |
| image        | varchar(255)     | NO   |     | img/rooms/default.png |                |
| created_at     | timestamp             | YES  |     | NULL    |                | 创建时间 |
| updated_at     | timestamp             | YES  |     | NULL    |                | 修改时间 |

房间分类表(room_types)设计：

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| id             | int(10) unsigned      | NO   | PRI | NULL    | auto_increment | 主键 |
| name       | varchar(255)     | NO   |     | NULL    |                | 名称 ｜
| created_at     | timestamp             | YES  |     | NULL    |                | 创建时间 |
| updated_at     | timestamp             | YES  |     | NULL    |                | 修改时间 |

订单表(orders)设计：

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| id             | int(10) unsigned      | NO   | PRI | NULL    | auto_increment | 主键 |
| room_no      | varchar(255)     | NO   | MUL | NULL                |                             | 房间号 |
| phone        | varchar(11)      | NO   |     | NULL                |                             | 手机号 |
| idcard       | varchar(18)      | NO   |     | NULL                |                             | 身份证号 |
| check_in_at  | timestamp        | NO   |     | CURRENT_TIMESTAMP   | on update CURRENT_TIMESTAMP | 预约日期 |
| check_out_at | timestamp        | NO   |     | 0000-00-00 00:00:00 |                             | 退房日期 |
| created_at     | timestamp             | YES  |     | NULL    |                | 创建时间 |
| updated_at     | timestamp             | YES  |     | NULL    |                | 修改时间 |

系统设置表(settings)设计：

|字段名称|类型|是否为空|键|默认|附加|说明|
|------------|------------------|------|-----|---------|----------------|---------------|
| id             | int(10) unsigned      | NO   | PRI | NULL    | auto_increment | 主键 |
| company         | varchar(255)     | NO   |     | NULL    |                | 酒店名称 |
| welcome_title   | varchar(255)     | NO   |     | NULL    |                | 欢迎标题 |
| welcome_content | varchar(255)     | NO   |     | NULL    |                | 欢迎描述 |
| service_title   | varchar(255)     | NO   |     | NULL    |                | 服务标题 |
| service_content | varchar(255)     | NO   |     | NULL    |                | 服务描述 |
| weibo           | varchar(255)     | YES  |     | NULL    |                | 微博 |
| facebook        | varchar(255)     | YES  |     | NULL    |                | facebook |
| twitter         | varchar(255)     | YES  |     | NULL    |                | twitter |
| created_at     | timestamp             | YES  |     | NULL    |                | 创建时间 |
| updated_at     | timestamp             | YES  |     | NULL    |                | 修改时间 |

# 四，系统的详细设计和实现

### 4.1 处理过程设计

### 4.1.1 处理流程图

用户登陆流程图：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f2srh8ri14j207r0amjrh.jpg)

可以清楚的看到我们程序的整个流程，如果信息输入错误则无法登陆到后台对系统进行管理。

房间查询流程图：

![](http://ww4.sinaimg.cn/mw690/baa3278fgw1f34hru344oj20540dmjrf.jpg)

在我们的酒店网站上直接输入你想要过滤的条件，点击按钮来进行搜索房间，可以选择价位区间，选择打折进行查询。

当然，一个功能齐全的网站流程图是画不玩的，所以，这里挑选一个有代表性的难点输出，也就是房间预约流程图：

![](http://ww4.sinaimg.cn/mw690/baa3278fgw1f34hz3qngrj20cv0cmgm8.jpg)

这里也属于该系统的一个难点了，再后面的章节还会对其进行一些具体分析。

# 4.2　功能处理设计

* 查看酒店全部人员（管理员和会员）
    * 用户名称： 查看酒店全部人员（管理员和会员）
    * 用例描述： 查看酒店全部人员（管理员和会员）
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，点击酒店全部人员（管理员和会员）

* 删除酒店全部人员（管理员和会员）
    * 用户名称： 删除酒店全部人员（管理员和会员）
    * 用例描述： 删除酒店全部人员（管理员和会员）
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示删除成功，刷新页面
    * 基本路径: 控制台，点击酒店全部人员（管理员和会员），点击删除按钮，弹出提示信息，点击确认

* 查看酒店房间分类
    * 用户名称： 查看酒店房间分类
    * 用例描述： 查看酒店房间分类
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，点击酒店房间分类

* 新增酒店房间分类
    * 用户名称： 新增酒店房间分类
    * 用例描述： 新增酒店房间分类
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示增加成功，跳转显示所有分类
    * 基本路径: 控制台，点击酒店房间分类，点击增加按钮，填写正确信息，确认

* 修改酒店房间分类
    * 用户名称： 修改酒店房间分类
    * 用例描述： 修改酒店房间分类
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示修改成功，跳转显示所有分类
    * 基本路径: 控制台，点击酒店房间分类，点击修改，填写正确信息，确认

* 删除酒店房间分类
    * 用户名称： 删除酒店房间分类
    * 用例描述： 删除酒店房间分类
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示删除成功，刷新页面
    * 基本路径: 控制台，点击酒店房间分类，点击删除按钮，弹出提示信息，点击确认

* 查看酒店房间
    * 用户名称： 查看酒店房间
    * 用例描述： 查看酒店房间
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，点击酒店房间

* 新增酒店房间
    * 用户名称： 新增酒店房间
    * 用例描述： 新增酒店房间
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示增加成功，跳转显示所有
    * 基本路径: 控制台，点击酒店房间，点击增加按钮，填写正确信息，确认

* 修改酒店房间
    * 用户名称： 修改酒店房间
    * 用例描述： 修改酒店房间
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示修改成功，跳转显示所有
    * 基本路径: 控制台，点击酒店房间，点击修改，填写正确信息，确认

* 删除酒店房间
    * 用户名称： 删除酒店房间
    * 用例描述： 删除酒店房间
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示删除成功，刷新页面
    * 基本路径: 控制台，点击酒店房间，点击删除按钮，弹出提示信息，点击确认

* 查看酒店预约订单
    * 用户名称： 查看酒店预约订单
    * 用例描述： 查看酒店预约订单
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，点击酒店预约订单

* 新增酒店预约订单
    * 用户名称： 新增酒店预约订单
    * 用例描述： 新增酒店预约订单
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示增加成功，跳转显示所有
    * 基本路径: 控制台，点击酒店预约订单，点击增加按钮，填写正确信息，确认

* 修改酒店预约订单
    * 用户名称： 修改酒店预约订单
    * 用例描述： 修改酒店预约订单
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示修改成功，跳转显示所有
    * 基本路径: 控制台，点击酒店预约订单，点击修改，填写正确信息，确认

* 删除酒店预约订单
    * 用户名称： 删除酒店预约订单
    * 用例描述： 删除酒店预约订单
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示删除成功，刷新页面
    * 基本路径: 控制台，点击酒店预约订单，点击删除按钮，弹出提示信息，点击确认

* 修改系统设置
    * 用户名称： 修改系统设置
    * 用例描述： 修改系统设置
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 提示修改成功，刷新页面
    * 基本路径: 控制台，点击系统设置，然后输入信息，点击确认

* 根据房间号查找流水
    * 用户名称： 根据房间号查找流水
    * 用例描述： 根据房间号查找流水
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，选择房间号，点击查找，显示初查找结果

* 根据房间类型查找流水
    * 用户名称： 根据房间类型查找流水
    * 用例描述： 根据房间类型查找流水
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，选择房间类型，点击查找，显示初查找结果

* 根据日期查找流水
    * 用户名称： 根据日期查找流水
    * 用例描述： 根据日期查找流水
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，选择日期，点击查找，显示初查找结果

* 根据日期维度查找流水
    * 用户名称： 根据日期维度查找流水
    * 用例描述： 根据日期维度查找流水
    * 角色: 管理员
    * 前置条件： 成功登陆
    * 后置条件： 无
    * 基本路径: 控制台，填写日期维度，点击查找，显示初查找结果

* 注册用户
    * 用户名称： 注册用户
    * 用例描述： 注册用户
    * 角色: 游客
    * 前置条件： 进入注册页面
    * 后置条件： 登陆到首页
    * 基本路径: 填写正确注册信息，点击注册

* 用户登录
    * 用户名称： 用户登录
    * 用例描述： 用户登录
    * 角色: 游客
    * 前置条件： 进入登录页面
    * 后置条件： 登录到首页
    * 基本路径: 填写正确登录信息，点击登录

* 用户登录
    * 用户名称： 用户退出登录
    * 用例描述： 用户退出登录
    * 角色: 游客
    * 前置条件： 登录中
    * 后置条件： 无
    * 基本路径: 点击右上角的退出按钮

* 查看所有房间
    * 用户名称： 查看所有房间
    * 用例描述： 查看所有房间
    * 角色: 所有人
    * 前置条件： 进入网站
    * 后置条件： 无
    * 基本路径: 点击导航上的所有房间

* 根据价格区间查找房间
    * 用户名称： 根据价格区间查找房间
    * 用例描述： 根据价格区间查找房间
    * 角色: 所有人
    * 前置条件： 进入网站
    * 后置条件： 无
    * 基本路径: 输入最低价，最高价，点击搜索按钮

* 根据折扣查找房间
    * 用户名称： 根据折扣查找房间
    * 用例描述： 根据折扣查找房间
    * 角色: 所有人
    * 前置条件： 进入网站
    * 后置条件： 无
    * 基本路径: 输入折扣，点击搜索按钮

### 4.3 界面设计

本系统全部都使用　Bootstrap　作为基础搭建。

### 4.3.1　Bootstrap　介绍

Bootstrap 的学习非常简单，并且它所提供的样式又非常精美。只要稍微简单的学习就可以制作出漂亮的页面。如今基于Bootstrap框架的免费HTML5网站已经开始成为行业趋势。研究人员已经证实，Bootstrap是引领设计和开发行业趋势效果最为显著的。这就是为什么，开发商使用基于Bootstrap的HTML5模板来创建他们的网站的重要原因。

### 4.3.2 界面截图预览

首先，这是酒店网站首页：

![](http://ww3.sinaimg.cn/mw690/baa3278fgw1f34iozw6vnj21190hswq9.jpg)

另外，网站的图片十滚动的，可以手动添加。

这是房间搜索界面：

![](http://ww4.sinaimg.cn/mw690/baa3278fgw1f34ip0vb4hj211g0iewoe.jpg)

登录到后台之后，是这样的：

![](http://ww3.sinaimg.cn/mw690/baa3278fgw1f34ip1e1fkj211i0b0gm5.jpg)

这是系统设置的界面：

![](http://ww2.sinaimg.cn/mw690/baa3278fgw1f34ip10uppj210z0i0wft.jpg)

这是房间列表的界面：

![](http://ww3.sinaimg.cn/mw690/baa3278fgw1f34ip1roa7j210v0hxjtl.jpg)

### 4.4　程序实现

本系统使用 laravel 作为框架，毫无夸张地说，代码量超级大，所以这边以　MVC 为基础去介绍一下系统的基本实现。

首先，介绍下主要的目录结构，以便后面更深的去了解程序本身，不过，这也是简化之后的，实际上更加的复杂：

```plain
app/ - 主要核心业务代码
    Events/ - 事件
    Exceptions/ - 自定义异常的
    Http/ - 核心　Http　请求响应
        Controllers/ - 控制器
        Middleware/ - 中间件
        Requests/ - 请求数据处理
        routes.php - 定义路由
        validators.php - 自定义验证器
    Models/ - 模型
config/ - 配置文件
database/ - 数据库文件
resources/ - 资源文件
    assets/ - css, js 预编译文件
    lang/ - 多语言
    views/ - 视图
tests/ - 测试文件夹
.env - 系统变量
```

这里面最好的地方就在 .env 文件，你可以将系统的设置或者一些隐私信息存储在里面，这样可以很快的修改，很方便的设计。

我们先来对最重要的用户模型进行解释

```php
class User extends Authenticatable
{
    /**
     * The attributes that are mass assignable.
     *
     * @var array
     */
    protected $fillable = [
        'name', 'email', 'password', 'is_admin'
    ];

    /**
     * Format the output.
     *
     * @var array
     */
    protected $casts = [
        'is_admin' => 'bool'
    ];

    /**
     * The attributes excluded from the model's JSON form.
     *
     * @var array
     */
    protected $hidden = [
        'password', 'remember_token',
    ];
}
```

这里可以看到，这里的 fillable 数组映射到数据库中对应的字段，当然，hidden　则是保护用户的隐藏信息。

来看最关键的订单模型吧：

```php
class Order extends Model
{
    protected $fillable = [
        'room_no',
        'phone',
        'idcard',
        'check_in_at',
        'check_out_at',
    ];

    protected $dates = ['check_in_at', 'check_out_at'];

    protected $casts = [
        'phone' => 'int'
    ];

    public function room()
    {
        return $this->belongsTo('App\Models\Room', 'room_no', 'no');
    }

    public static function getIncoming($orders = null)
    {
        $orders = $orders ?: self::with('room')->get();

        return $orders->reduce(function($incoming, $order) {
            return $incoming += $order->room->price * $order->getStayDays();
        }, 0);
    }

    public function getStayDays()
    {
        return $this->check_in_at->diffInDays($this->check_out_at);
    }
}
```

首先，`room` 代表着每个订单属于一个房间，也就是一个一对一模型，那么我们就可以在当前的订单中去获取到房间的信息。接下来更为关键的是去统计我们的收入问题了，`getIncoming`　这个方法懂的人可以看明白，写的很好，使用 reduce 去计算我们的收入。

# 五，系统测试

### 5.1　系统测试的必要性

软件从需求分析开始，就会引入错误。而且越是前期的错误，造成的损失就越大。需求分析，就是将用户的需求转化成产品的需求。这是系统架构师需要做的事情。系统架构师需要明确这个产品该如何来满足用户的需求，有哪些use case，这些use case直接关系到V-mode中对应着的系统测试的test case。系统架构师需要来自系统测试人员的反馈，来判断这个case的可测性和可用性。用户是否真的需要这些case，系统测试人员往往会给出他们的意见。Use case的偏差，直接会导致用户的不满，而且有可能导致整个feature的失败。我们有过不少这样的经历，就是系统架构师在需求阶段容易求大求全，在系统的复杂性和新功能对系统的影响上，在客户如何使用新feature上没有经验，在开发和测试阶段，麻烦不断，导致整个feature无法按期完成，最后不了了之，所有的努力都付之东流。系统测试人员在需求阶段加入，可以从用户的角度给架构师以反馈，告诉他什么功能是用户最需要的，什么功能是可有可无的，用户最关注的点在哪里。这样，架构师就可以有所取舍，将最能满足用户，且易实现和测试的部分规划出来，进行优化，舍弃那些对用户来说可有可无，却占到大量开发和测试时间的部分。一个公司的架构师往往是从软件开发人员培养而来，他们过多地重视开发成本，而忽视测试成本，也忽视用户的使用感受。记得有一个产品经理曾经告诉我，他们很难获得用户的真实感受，因为和用户开会的时间非常有限，一两个小时的会议，要讨论几十个新feature，每个feature只能占用5分钟，很难在这5分钟里问清所有的问题，只能靠猜。其实，比猜更有效的方法，是培养优秀的系统测试人员。他们不但熟悉测试，也能通过验证用户报的bug了解用户对feature的使用，也能够体会用户的感受。让系统测试人员参与需求分析过程，避免系统架构师出现大的偏差，帮助系统架构师预测用户对新feature的使用方式，是对产品质量提升的一个很重要的手段。

# 5.2 测试数据

|测试编号|测试输入|期待输出|实际输出|说明|
|-------|-------|-------|-------|-------|
|1      |首页测试|显示首页画面|显示首页画面|测试的第一步，确保可以访问，服务器正常|
|2      |增加酒店房间分类测试|提示增加成功|提示增加成功|测试能添加酒店房间分类|
|3     |修改酒店房间分类测试|提示修改成功|提示修改成功|测试能添加酒店房间分类|
|4     |删除酒店房间分类测试|提示删除成功|提示删除成功|测试能添加酒店房间分类|
|5     |增加酒店房间测试|提示增加成功|提示增加成功|测试能添加酒店房间|
|6     |修改酒店房间测试|提示修改成功|提示修改成功|测试能添加酒店房间|
|7     |删除酒店房间测试|提示删除成功|提示删除成功|测试能添加酒店房间|
|8     |增加酒店订单测试|提示增加成功|提示增加成功|测试能添加酒店订单|
|9     |修改酒店订单测试|提示修改成功|提示修改成功|测试能添加酒店订单|
|10     |删除酒店订单测试|提示删除成功|提示删除成功|测试能添加酒店订单|
|11     |修改系统设置|提示修改成功，网站成功显示|提示修改成功，网站成功显示|测试能正常修改系统设置|
|12     |登录测试|登陆到后台管理界面|登陆到后台管理界面|测试能登录成功|
|13     |注册测试|登陆到后台管理界面|登陆到后台管理界面|测试能注册成功|
|14     |退出登录测试|退出到首页|退出到首页|测试能退出登录成功|
|15     |修改资料测试|提示修改成功|提示修改成功|测试能修改资料|
|16     |找回密码测试|提示修改成功，跳转到登录页面|提示修改成功，跳转到登录页面|测试能退找回密码|
|17     |测试按最低价查找房间|显示结果|显示结果|测试能按最低价查找房间|
|18     |测试按最高价查找房间|显示结果|显示结果|测试能按最高价查找房间|
|19     |测试按折扣查找房间|显示结果|显示结果|测试能按折扣查找房间|
|20     |测试按房间类型查找流水|显示结果|显示结果|测试能按房间类型查找流水|
|21     |测试按房间号查找流水|显示结果|显示结果|测试能按房间号查找流水|
|22     |测试按时间日期查找流水|显示结果|显示结果|测试能时间日期型查找流水|
|23     |测试按时间日期查找流水|显示结果|显示结果|测试能时间日期型查找流水|
|24     |测试按时间日期范围查找流水|显示结果|显示结果|测试能时间日期范围型查找流水|

### 5.3 测试结果分析

根据系统的需求，然后结合该测试，可以确保系统能够正常运行，所以，该系统可以提交，能够满足毕设的要求。
